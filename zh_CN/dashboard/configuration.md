# 管理

EMQX 提供了强大的管理功能，用于优化系统配置、扩展协议支持、增强 MQTT 的高级功能以及实现插件扩展。通过这些管理功能，用户可以在无需停止服务的情况下，动态调整系统配置，提升整体性能和操作灵活性。这些管理功能主要包括以下几个方面：

- **集群配置**：通过热配置能力动态调整系统设置，支持多种核心配置如 MQTT 参数、监听器、日志、监控和集群连接管理。
- **MQTT 高级特性**：实现对主题重写、自动订阅、延迟发布、文件传输等功能的便捷配置，进一步扩展 MQTT 的使用场景。
- **插件扩展**：通过内置扩展机制和多协议网关支持，提供灵活的协议适配能力，同时支持用户自定义钩子和插件开发。

EMQX 的管理功能通过可视化 Dashboard 界面提供直观的操作体验，帮助用户快速上手并灵活运用这些功能，满足复杂的物联网场景需求。以下章节详细介绍各模块的功能和配置。

## 集群配置

EMQX 提供了热配置能力，可以在运行时动态修改配置，无需重启 EMQX 节点。在 Dashboard 页面中，我们针对热配置功能，提供了一个可视化配置页面，通过该页面，可以方便的修改 EMQX 的配置。目前提供了以下配置项：

- MQTT 配置
- 监听器
- 日志
- 监控
- 集群连接

### MQTT 配置

点击左侧菜单中的**管理** -> **MQTT 配置**进入 MQTT 协议相关的配置页面。在 MQTT 配置页面中，我们可以配置 MQTT 协议相关的配置项，包括：

#### 通用

通用菜单下为 MQTT 协议的通用基础配置项，包括类似于配置空闲超时，最大报文大小，最大 Client ID 长度，主题层级和 QoS 等级等配置项。

#### 会话

会话菜单下为 MQTT 协议的会话相关配置项，包括会话过期间隔（仅支持非 MQTT 5.0 连接，MQTT 5.0 连接需在客户端配置），最大订阅数量，最大飞行窗口，是否存储QoS 0 消息等相关配置。

#### 会话持久化

会话持久化菜单下为 [MQTT 会话持久化](../durability/durability_introduction.md)功能的相关配置项，包括消息保留时长，消息查询批大小，空闲轮询间隔，会话心跳间隔等。

#### 保留消息

保留消息菜单下为 MQTT 协议的保留消息相关配置项，例如是否开启保留消息功能，消息的存储类型与方式，保留消息的最大数量，保留消息的负载大小，保留消息过期间隔等相关配置。当需要对保留消息进行配置修改时，就可以在这里进行配置。详见[设置保留消息](./retained.md#设置保留消息)。

> 当停用保留消息时，已有的保留消息将不会被删除。

#### 系统主题

系统主题菜单下为 EMQX 内置的系统主题相关配置项，EMQX 将周期性的将运行状态，使用统计和即时客户端事件发布到 `$SYS/` 开头的系统主题，当客户端订阅该主题时，EMQX 将会将相关的信息发布到该主题下。系统主题的配置项包括消息发布周期，心跳周期等相关配置。

### 监听器

点击左侧菜单中的**管理** -> **监听器**进入监听器页面。该页面默认是一个监听器的列表页。EMQX 默认提供了四个常用的监听器：

- 使用 1883 端口的 TCP 类型监听器
- 使用 8883 端口的 SSL/TLS 安全连接类型监听器
- 使用 8083 端口的 WebSocket 类型监听器
- 使用 8084 端口的 WebSocket 安全类型监听器

![image](https://docs.emqx.com/assets/config-listener-list.7iplyMvV.png)

通常使用以上默认的监听器，输入对应端口和协议类型即可。如果需要添加其他类型的监听器，可以点击右上角的**添加监听器**按钮，添加一个新的监听器。

#### 添加监听器

在右侧弹出的面板中可以看到一个添加监听器的表单，其中中包含了监听器的基本配置项。您可以输入一个监听器名称用于标识该监听器；选择一个监听器类型，包括 tcp、ssl、ws 和 wss 类型；输入监听器地址，可以输入 IP 地址和端口号，使用 IP 地址可以限制监听器的访问范围，也可以直接输入一个端口号。

![image](https://docs.emqx.com/assets/config-listener-add.190v3Kn-.png)

##### 速率限制

在**添加监听器**表单中的**速率限制**区域，您可以对 EMQX 的使用时，接入消息，分发消息的速率进行限制，包括：

- 最大连接速率（监听器）
- 最大消息发布速率（单客户端）
- 最大消息发布流量（单客户端）

配置速率限制可以在当消息数据过载或客户端过度请求时确保系统和网络的稳定性。

更多关于速率限制的详细配置文档，请参考[速率限制](../rate-limit/rate-limit.md)。

更多关于监听器配置的详情，请参考[开源版配置手册](https://docs.emqx.com/zh/emqx/v@CE_VERSION@/hocon/)和[企业版配置手册](https://docs.emqx.com/zh/enterprise/v@EE_VERSION@/hocon/)。

#### 管理监听器

完成添加一个监听器后，可以在列表中看到该监听器。点击监听器名称进入到编辑页面，在该页面下可以修改该监听器的配置或删除一个监听器。需要注意的是，监听器名称、类型和监听地址不可在设置中再次修改。

点击编辑页面中的**删除**按钮，可以删除该监听器。当删除监听器时，需要输入目前正在删除的监听器名称，以确认删除操作。列表中我们还可以点击启用开关来启用或者禁用该监听器。列表中还可以查看每个监听器下的连接数。

::: tip 注意

修改和删除监听器是一个带有危险性的操作，需要谨慎操作。如果更新或删除了一个监听器，那么该监听器上的客户端连接将会被断开。

:::

### 日志

点击左侧菜单中的**管理**->**日志**进入日志相关的配置页面。该页面包含**控制台日志**、**文件日志**、**日志限流**，和**审计日志**标签页。

EMQX 支持两种不同的日志输出方式：控制台输出日志和文件输出日志。您可以根据需要选择输出方式或同时启用这两种方式。在相应的配置页面中，可以设置是否启用日志处理进程，设置日志级别，日志格式类型，文件日志还可以设置日志文件的路径和日志名称。更多关于日志的详细配置说明，请参考[通过 Dashboard 修改日志配置](../observability/log.md#通过-dashboard-修改日志配置)。

在**日志限流**配置页面，您可以设置日志限流的时间窗口。关于日志限流功能的介绍，参考[日志限流](../observability/log.md#日志限流)。

在**审计日志**配置页面，您可以启用或禁用审计日志这一企业版功能并对该功能进行相关配置。详细的配置说明，参考[通过 Dashboard 启用](./audit-log.md#通过-dashboard-启用)。

### 监控

::: tip 注意

监控功能仅适用于 EMQX 企业版。

:::

点击左侧配置中的**管理** -> **监控**进入监控集成的配置页面。该页面下包含有两个标签页：

- **系统**：根据用户需要，针对[告警](./diagnose.md#告警)功能进行一定程度的设置调整，如告警阈值、检查间隔等。
- **监控集成**：提供了与第三方监控平台的集成配置。

#### 系统

如当前告警触发阈值或告警监控检查间隔的默认值不符合用户的实际需要，可以在此页面进行设置调整。当前设置分为两个模块：**Erlang 虚拟机**和**操作系统**，各配置项的默认值和说明可查看[告警](https://docs.emqx.com/zh/emqx/latest/observability/alarms.html)。

#### 监控集成

该页面主要提供了与第三方监控平台的集成配置，目前 EMQX 提供了与 Prometheus 的集成方式。配置页面可以快速开启该配置，并配置推送数据地址与数据上报时间间隔等。

当使用 `Prometheus` 第三方监控服务时我们可以直接使用 EMQX 提供的 API `/prometheus/stats` 来获取监控数据，使用该 API 时不需要认证信息，具体的 API 请参考 [Prometheus](../observability/prometheus.md)。

或者可以选择配置一个 `Pushgateway` 的服务地址，来将监控数据推送到 `Pushgateway`，然后再由 `Pushgateway` 推送到 `Prometheus` 服务。通常情况下我们不需要使用 `Pushgateway` 就能监控到 EMQX 的指标数据，点击查看[何时使用 Pushgateway](https://prometheus.io/docs/practices/pushing/)。

点击底部的**帮助**按钮，选择默认或使用 `Pushgateway` 的方式，根据提供的使用步骤，配置相关所需服务的地址或 API 信息，即可快速生成对应的 `Prometheus` 配置文件，最后再使用该配置文件来启动 `Prometheus` 服务即可。

启动 `Prometheus` 服务后，可以在帮助页面的最后，点击下载我们提供的 `Grafana` 默认的监控面板的配置文件，将该文件导入到 `Grafana` 中，我们就可以通过可视化面板来查看 EMQX 的监控数据，用户也可以根据需求在 `Grafana` 中对监控数据进行自定义修改。同时模版也可以在 [Grafana 官方网站](https://grafana.com/grafana/dashboards/17446-emqx/)中下载。

![image](https://docs.emqx.com/assets/emqx-grafana.OnkGjqvG.jpg)

### 集群连接

::: tip 注意

集群连接功能仅适用于 EMQX 企业版。

:::

集群连接功能可以将多个独立的 EMQX 集群连接在一起，因此通常地理位置分散的不同集群之间的客户端能够相互通信。用户可以在该页面中创建和配置集群连接。具体的创建和配置指导，参考 [EMQX 集群连接](../cluster-linking/introduction.md)。

## MQTT 高级特性

::: tip 注意

MQTT 高级特性仅适用于 EMQX 企业版。

:::

### 主题重写

主题重写功能可以帮助实现修改设备业务主题。通过给 EMQX 设置一套规则，它可以在订阅、发布时改变将原有主题重写为新的目标主题。该页面方便用户通过 Dashboard 添加主题重写规则而无需修改配置文件。详细的主题重写规则，参考[主题重写](../messaging/mqtt-topic-rewrite.md)。

### 自动订阅

自动订阅是 EMQX 支持的 MQTT 扩展功能。自动订阅能够给 EMQX 设置多个规则，在设备成功连接后按照规则为其订阅指定主题，不需要额外发起订阅。该页面方便用户通过 Dashboard 配置自动订阅功能。具体的配置指导，参考[自动订阅](../messaging/mqtt-auto-subscription.md)。

### 延迟发布

延迟发布是 EMQX 支持的 MQTT 扩展功能。当客户端使用特殊主题前缀 `$delayed/{DelayInteval}` 发布消息时，将触发延迟发布功能，可以实现按照用户配置的时间间隔延迟发布消息。该页面方便用户通过 Dashboard 配置延迟发布功能。具体的配置指导，参考[通过 Dashboard 配置延迟发布](../messaging/mqtt-delayed-publish.md#通过-dashboard-配置延迟发布)。

### 文件传输

基于 MQTT 的文件传输是 EMQX 企业版的高级功能。EMQX 扩展了 MQTT 协议，使客户端设备除了能够传输传感器数据和控制指令这样的实时结构化数据，还能够传输、管理和存储离线类型的文件数据，如音视频、图片和诊断日志等。您可以在文件传输页面配置该功能。具体的配置指导，参考[通过 Dashboard 启用和配置文件传输](../file-transfer/broker.md#通过-dashboard-启用和配置文件传输)。

## 插件扩展

::: tip 注意

MQTT 扩展功能仅适用于 EMQX 企业版。

:::

插件菜单下为 EMQX 内置的扩展相关配置项，为使用 MQTT 协议的客户端提供了一些扩展功能，包括：多协议网关、ExHook 和插件。

### 网关

EMQX 多协议网关支持处理所有非 MQTT 协议的连接、认证以及消息的收发操作，并为多种协议提供了统一的概念模型。

在网关页面中，您可以启用网关，并对网关进行基础配置，例如配置监听器。此外，EMQX 还提供了自定义的配置项。具体的配置指导，参考以下常用网关的快速开始文档：

- [MQTT-SN](../gateway/mqttsn.md)
- [STOMP](../gateway/stomp.md)
- [CoAP](../gateway/coap.md)
- [LwM2M](../gateway/lwm2m.md)
- [ExProto](../gateway/exproto.md)

以下几种网关仅在 EMQX 企业版中支持：

- [OCPP](../gateway/ocpp.md)
- [GB/T 32960](../gateway/gbt32960.md)
- [JT/T 808](../gateway/jt808.md)

### ExHook

钩子 (Hooks) 是一种常见的扩展机制，允许开发者在特定的事件点执行自定义代码。EMQX 支持钩子机制，通过拦截模块间的函数调用、消息传递、事件传递您可以灵活地修改或扩展系统功能。

在 ExHook 页面，您可以查看钩子的基本信息和状态，同时还可以添加和配置钩子。

### 插件

EMQX 支持通过插件扩展自定义业务逻辑，或通过插件的协议扩展接口实现其他协议适配。在插件页面，您可以安装和启动开发好的插件包，以及对插件进行维护和配置。具体的使用指导，参考[插件](../extensions/plugins.md)。
