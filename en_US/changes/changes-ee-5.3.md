# Releases

## e5.3.0

### Enhancements

- [#11637](https://github.com/emqx/emqx/pull/11637) Added an extra diagnostic to help debug issues when mnesia is waiting for tables.

  Updated libraries: `ekka` -> 0.15.15, `mria` -> 0.6.4.

- [#11581](https://github.com/emqx/emqx/pull/11581) Preview Feature: Support for Version 2 Bridge Design

  - Introduction of Bridge v2 with a new 'connector' concept

  - In the original Bridge v1 design, each connector was exclusively tied to a single bridge.
  This design prioritized error isolation and performance but posed challenges for users setting up multiple bridges to the same service.
  For instance, setting up 10 bridges to a single Kafka cluster required the same configuration to be repeated for each bridge.

  - The revamped Bridge v2 design provides more flexibility and better scalability:
  - Users have the option to either share a connector across multiple bridges or retain it exclusively for one bridge, as in v1.
  - For the majority of data bridges, sharing a connector among too many bridges might lead to performance degradation but avoids
  overloading the external system with too many connections if the number of bridges is very high.
  - In some cases, specific data bridges always utilize dedicated connections, even when the connector is shared.
  Right now these are:
  - Kafka Producer
  - Azure Event Hub Producer

  - Management of Connectors
  - Connectors can now be managed separately, bringing in more flexibility.
  - New API endpoints have been introduced under the `/connectors` path for connector management.
  - Version 2 bridges can be managed via the `/bridges_v2` endpoint.

  - Limitations in e5.3.1

  - Currently, only the Kafka and Azure Event Hub producer bridges have been upgraded to the v2 design.
  - The v2 bridge feature is accessible through config files and HTTP APIs. However, it's not yet available on the dashboard UI.



### Bug Fixes

- [#11565](https://github.com/emqx/emqx/pull/11565) Upgraded jq library from v0.3.10 to v0.3.11. In this version, jq_port programs are initiated on-demand and will not appear in users' processes unless the jq function in EMQX is used. Additionally, idle jq_port programs will auto-terminate after a set period. Note: Most EMQX users, running jq in NIF mode, will be unaffected by this update.

- [#11676](https://github.com/emqx/emqx/pull/11676) Hide few pieces of sensitive information from debug-level logs.

- [#11697](https://github.com/emqx/emqx/pull/11697) Disable outdated TLS versions and ciphersuites in the EMQX backplane network (`gen_rpc`).
  Allow using tlsv1.3 on the backplane.

  Add new configuration parameters: `EMQX_RPC__TLS_VERSIONS` and `EMQX_RPC__CIPHERS`.

  The corresponding `gen_rpc` PR: https://github.com/emqx/gen_rpc/pull/36

- [#11734](https://github.com/emqx/emqx/pull/11734) Fix clustering in IPv6 network.

  Added new configurations `rpc.listen_address` and `rpc.ipv6_only` to allow EMQX cluster RPC server and client to use IPv6.

- [#11747](https://github.com/emqx/emqx/pull/11747) Update QUIC stack to msquic 2.2.3.


- [#11796](https://github.com/emqx/emqx/pull/11796) Fix rpc schema, ensure client/server use same transport driver.


- [#11798](https://github.com/emqx/emqx/pull/11798) Fixed the issue where the node could not start after executing `./bin/emqx data import [FILE]`.

  And strongly bind apikey's `apikey_key` to `apikey_name`.
  - `apikey_key` will generate a unique value from the given human-readable `apikey_name` when generating an apikey using dashboard.
  - `apikey_name` will be a unique value generated by `apikey_key` when using bootstrap file to generate apikey, .

- [#11813](https://github.com/emqx/emqx/pull/11813) Fix schema: RPC client ssl port alighn with configured server port.
  And ensure RPC ports are opened in helm chart.



- [#11819](https://github.com/emqx/emqx/pull/11819) Upgrade opentelemetry library to v1.3.1-emqx

  This opentelemetry release fixes invalid metrics timestamps in the exported metrics.

- [#11861](https://github.com/emqx/emqx/pull/11861) Fix excessive warning message print in remote console shell.


- [#11722](https://github.com/emqx/emqx/pull/11722) Fixed an issue where a Kafka Producer bridge with `sync` query mode would not buffer messages when in the `connecting` state.

- [#11724](https://github.com/emqx/emqx/pull/11724) Fixed a metrics issue where messages sent to Kafka would count as failed even when they were successfully sent late due to its internal buffering.

- [#11728](https://github.com/emqx/emqx/pull/11728) Improved the LDAP filter string parser:
  1. Automatically escape special characters in filter strings.
  2. Fixed a bug that the filter value can't be `dn`.

- [#11733](https://github.com/emqx/emqx/pull/11733) Resolved an incompatibility issue that led to crashes during session takeover / channel eviction when the session was residing on a remote node running EMQX v5.2.x or earlier.

- [#11750](https://github.com/emqx/emqx/pull/11750) Eliminated logging and tracing of HTTP request bodies in HTTP authentification and HTTP bridges.

- [#11760](https://github.com/emqx/emqx/pull/11760) Simplified the CQL query employed for Cassandra bridge health check that was apparently the source of warnings in Cassandra server logs.


## e5.3.0

### Enhancements

- [#11597](https://github.com/emqx/emqx/pull/11597) Upgraded ekka to 0.15.13, which incorporates the following changes:
  - Upgraded Mria to 0.6.2.
  - Introduced the ability to configure the bootstrap data sync batch size, as detailed in [Mria PR](https://github.com/emqx/mria/pull/159).
  - Enhanced the reliability of mria_membership processes, as described in [Mria PR](https://github.com/emqx/mria/pull/156).
  - Fix log message formatting error.
  - Added `node.default_bootstrap_batch_size` option to EMQX configuration.
  Increasing the value of this option can greatly reduce a replicant node startup time, especially when the EMQX cluster interconnect network latency is high and the EMQX built-in database holds a large amount of data, e.g. when the number of subscriptions is high.
- [#11620](https://github.com/emqx/emqx/pull/11620) Added a new rule-engine SQL function `bytesize` to get the size of a byte-string. e.g. `SELECT * FROM "t/#" WHERE bytesize(payload) > 10`.
- [#11642](https://github.com/emqx/emqx/pull/11642) Updated to quicer version 0.0.200 in preparation for enabling openssl3 support for QUIC transport.

- [#11610](https://github.com/emqx/emqx/pull/11610) Implemented a preliminary Role-Based Access Control for the Dashboard.

  In this version, there are two predefined roles:
  - Administrator: This role could access all resources.
  
  - Viewer: This role can only view resources and data, corresponding to all GET requests in the REST API.
  
- [#11631](https://github.com/emqx/emqx/pull/11631) Added Single Sign-On (SSO) feature and integrated with LDAP.

- [#11656](https://github.com/emqx/emqx/pull/11656) Integrated the SAML 2.0 Support for SSO.

- [#11599](https://github.com/emqx/emqx/pull/11599) Supported audit logs to record operations from CLI, REST API, and Dashboard in separate log files.

### Bug Fixes

- [#11682](https://github.com/emqx/emqx/pull/11682) Fixed an issue where logging would stop if "Rotation Size" would be set to `infinity` on file log handlers.
- [#11567](https://github.com/emqx/emqx/pull/11567) Improve EMQX graceful shutdown (`emqx stop` command):
  - Increase timeout from 1 to 2 minutes.
  - Printed an error message if EMQX can't stop gracefully within the configured timeout.
  - Print periodic status messages while EMQX is shutting down.
- [#11584](https://github.com/emqx/emqx/pull/11584) Fixed telemetry reporting error on Windows when os_mon module is unavailable.
- [#11605](https://github.com/emqx/emqx/pull/11605) Lowered CMD_overridden log severity from warning to info.
- [#11622](https://github.com/emqx/emqx/pull/11622) Upgraded rpc library gen_rpc from 2.8.1 to 3.1.0.
- [#11623](https://github.com/emqx/emqx/pull/11623) Upgraded library `esockd` from 5.9.6 to 5.9.7. This upgrade included:
  * Enhancements regarding proxy protocol error and timeout. [esockd pr#178](https://github.com/emqx/esockd/pull/178)
  * Lowered `ssl_error` exceptions to info-level logging. [esockd pr#180](https://github.com/emqx/esockd/pull/180)
  * Malformed MQTT packet parsing exception log level is lowered from `error` to `info`.
  * In command `emqx ctl listeners` output, the `shutdown_count` counter is incremented
  when TLS handshake failure (`ssl_error`) or Malformed packet (`frame_error`) happens.
- [#11661](https://github.com/emqx/emqx/pull/11661) Fixed log formatter when log.HANDLER.formatter is set to 'json'. The bug was introduced in v5.0.4 where the log line was no longer a valid JSON, but prefixed with timestamp string and level name.
- [#11627](https://github.com/emqx/emqx/pull/11627) Fixed resources cleanup in HStreamdB bridge. Prior to this fix, HStreamDB bridge might report errors during bridge configuration updates, since hstreamdb client/producer were not stopped properly.
